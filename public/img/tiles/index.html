<!DOCTYPE html>
<html lang="en" class="h-100">
  <head>
    <meta charset="utf-8" />
    <title>Appalachian Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="imagetoolbar" content="no" />
    <style type="text/css">
      #map {
        background-color: var(--bs-light);
        height: calc(100vh - 56px);
      }
    </style>
    <!-- CSS only -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
      integrity="sha256-7ZWbZUAi97rkirk4DcEp4GWDPkWpRMcNaEyXGsNXjLg="
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://openlayers.org/en/v6.15.1/css/ol.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/ol-layerswitcher@3.8.3/dist/ol-layerswitcher.css"
      integrity="sha256-c07psiGWTzivFe9h3XU5MTknxsCDzRNsz+oS0ClcZg0="
      crossorigin="anonymous"
    />
  </head>

  <body class="h-100">
    <nav class="navbar navbar-expand-md navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Appalachian Map</a>
        <span class="navbar-text">
          Generated by
          <a href="https://gdal.org/programs/gdal2tiles.html">GDAL2Tiles</a>
        </span>
      </div>
    </nav>
    <main class="container-fluid px-0" id="map"></main>
    <script src="https://openlayers.org/en/v6.15.1/build/ol.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ol-layerswitcher@3.8.3/dist/ol-layerswitcher.min.js"></script>
    <script type="text/javascript">
      /** マップのサイズ [minx, miny, maxx, maxy] */
      const mapExtent = [0.0, -4096, 4096.0, 0.0];
      /** 最小ズームアウト値 */
      const mapMinZoom = 0;
      /** 最大ズームイン値 */
      const mapMaxZoom = 4;
      /** 解像度 */
      const mapMaxResolution = 64;
      /** マップの可動領域 [left, bottom, right, top) */
      const extentLimit = [0.0, -4096.0, 4096.0, 0.0];
      /** 全解像度 */
      const mapResolutions = [16, 8, 4, 2, 1];

      /** カスタム緯度経度 */
      const customProj = new ol.proj.Projection({
        code: 'raster',
        units: ol.proj.Units.TILE_PIXELS,
        extent: mapExtent,
      });
      ol.proj.addProjection(customProj);

      // idがmapにマップを埋め込む
      const map = new ol.Map({
        controls: ol.control.defaults().extend([
          // 現在地の座標
          new ol.control.MousePosition({
            className: 'text-end text-warning',
            coordinateFormat: o => {
              const ret = [];
              o.forEach(e => ret.push(e | 0));
              return ret;
            },
            target: document.getElementById('mouse-position'),
            undefinedHTML: '&nbsp;',
          }),
          // ズームスライダー
          new ol.control.ZoomSlider(),
          // マップスイッチャー
          new ol.control.LayerSwitcher(),
        ]),
        target: 'map',
        layers: [
          new ol.layer.Tile({
            title: 'Base',
            visible: true,
            source: new ol.source.TileImage({
              minZoom: mapMinZoom,
              maxZoom: mapMaxZoom,
              tileGrid: new ol.tilegrid.TileGrid({
                extent: mapExtent,
                resolutions: mapResolutions,
              }),
              url: 'base/{z}/{x}/{y}.webp',
              attributions: [
                'Fallout76 (C) Bethesda / Developed by <a href="https://logue.dev/">Logue</a>',
              ],
            }),
            isBaseLayer: true,
          }),
          new ol.layer.Tile({
            title: 'Military',
            visible: false,
            source: new ol.source.TileImage({
              minZoom: mapMinZoom,
              maxZoom: mapMaxZoom,
              tileGrid: new ol.tilegrid.TileGrid({
                extent: mapExtent,
                resolutions: mapResolutions,
              }),
              url: 'military/{z}/{x}/{y}.webp',
            }),
          }),
          new ol.layer.Tile({
            title: 'Realistic',
            visible: false,
            source: new ol.source.TileImage({
              minZoom: mapMinZoom,
              maxZoom: mapMaxZoom,
              tileGrid: new ol.tilegrid.TileGrid({
                extent: mapExtent,
                resolutions: mapResolutions,
              }),
              url: 'realistic/{z}/{x}/{y}.webp',
            }),
          }),
        ],
        view: new ol.View({
          // 中心座標（ブロック移動で弾き飛ばされる場所を原点とする）
          center: [0, 0],
          attribution: true,
          projection: customProj,
          extent: ol.proj.transformExtent(extentLimit, 'raster', customProj),
          resolution: mapMaxResolution,
          resolutions: mapResolutions,
        }),
      });
    </script>
  </body>
</html>
